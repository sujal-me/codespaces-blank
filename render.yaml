services:
  - type: web
    name: chest-xray-api
    runtime: python
    runtimeVersion: 3.12
    
    # Build configuration
    buildCommand: |
      pip install --upgrade pip setuptools wheel
      pip install -r deployment_requirements.txt
      python -m spacy download en_core_web_sm
    
    # Start command - uses gunicorn config for optimal memory usage
    startCommand: gunicorn -c gunicorn_config.py web_app_deployable:app
    
    # Environment variables
    envVars:
      - key: PYTHON_VERSION
        value: 3.12
      - key: PORT
        value: 8000
      - key: FLASK_ENV
        value: production
      - key: GEMINI_API_KEY
        value: ${GEMINI_API_KEY}  # Add this in Render dashboard
      - key: HF_TOKEN
        value: ${HF_TOKEN}        # Optional: Add if using Hugging Face models
    
    # Health check
    healthCheckPath: /
    
    # Resource allocation - optimized for 512MB free tier
    plan: free
    scaling:
      minInstances: 1
      maxInstances: 1
    
    # Disk size for model cache
    disk:
      name: model-cache
      mountPath: /var/lib/model-cache
      sizeGB: 10
